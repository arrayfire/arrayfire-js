{"version":3,"sources":["../es6/helpers.js"],"names":["Dim4","require","_","assert","fastcall","ArrayType","FloatArray","semver","helpers","exports","getHandle","array","handle","toBuffer","obj","Buffer","isBuffer","isArray","arr","length","i","set","Number","buffer","isTypedArray","_typedArrayToBuffer","TypeError","typedArrayToBuffer","byteLength","arrayToBuffer","byteOffset","gt","process","versions","node","from"],"mappings":"AAAA;;AACA,IAAMA,OAAOC,QAAQ,QAAR,CAAb;AACA,IAAMC,IAAID,QAAQ,QAAR,CAAV;AACA,IAAME,SAASF,QAAQ,QAAR,CAAf;AACA,IAAMG,WAAWH,QAAQ,UAAR,CAAjB;AACA,IAAMI,YAAYD,SAASC,SAA3B;AACA,IAAMC,aAAa,IAAID,SAAJ,CAAc,OAAd,CAAnB;AACA,IAAME,SAASN,QAAQ,QAAR,CAAf;;AAEA,IAAMO,UAAUC,OAAhB;;AAEAD,QAAQE,SAAR,GAAoB,UAAUC,KAAV,EAAiB;AACjC,QAAIA,MAAMC,MAAV,EAAkB;AACd,eAAOD,MAAMC,MAAb;AACH;AACD,WAAOD,KAAP;AACH,CALD;;AAOAH,QAAQK,QAAR,GAAmB,UAAUC,GAAV,EAAe;AAC9B,QAAIC,OAAOC,QAAP,CAAgBF,GAAhB,CAAJ,EAA0B;AACtB,eAAOA,GAAP;AACH;AACD,QAAIZ,EAAEe,OAAF,CAAUH,GAAV,CAAJ,EAAoB;AAChB,YAAMI,MAAM,IAAIZ,UAAJ,CAAeQ,IAAIK,MAAnB,CAAZ;AACA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIN,IAAIK,MAAxB,EAAgCC,GAAhC,EAAqC;AACjCF,gBAAIG,GAAJ,CAAQD,CAAR,EAAWE,OAAOR,IAAIM,CAAJ,CAAP,CAAX;AACH;AACD,eAAOF,IAAIK,MAAX;AACH;AACD,QAAIrB,EAAEsB,YAAF,CAAeV,GAAf,CAAJ,EAAyB;AACrB,eAAOW,oBAAoBX,GAApB,CAAP;AACH;AACD,UAAM,IAAIY,SAAJ,CAAc,iCAAd,CAAN;AACH,CAfD;;AAiBAlB,QAAQmB,kBAAR,GAA6B,UAAUT,GAAV,EAAe;AACxCf,WAAOD,EAAEsB,YAAF,CAAeN,GAAf,CAAP,EAA4B,sCAA5B;;AAEA,WAAOO,oBAAoBP,GAApB,CAAP;AACH,CAJD;;AAMA,SAASO,mBAAT,CAA6BP,GAA7B,EAAkC;AAC9B,QAAIA,IAAIU,UAAJ,KAAmBV,IAAIK,MAAJ,CAAWK,UAAlC,EAA8C;AAC1C,eAAOpB,QAAQqB,aAAR,CAAsBX,IAAIK,MAA1B,EAAkCL,IAAIY,UAAtC,EAAkDZ,IAAIU,UAAtD,CAAP;AACH;AACD,WAAOpB,QAAQqB,aAAR,CAAsBX,IAAIK,MAA1B,CAAP;AACH;;AAED,IAAIhB,OAAOwB,EAAP,CAAUC,QAAQC,QAAR,CAAiBC,IAA3B,EAAiC,OAAjC,CAAJ,EAA+C;AAC3C1B,YAAQqB,aAAR,GAAwB,UAAUX,GAAV,EAAeY,UAAf,EAA2BX,MAA3B,EAAmC;AACvD,eAAOJ,OAAOoB,IAAP,CAAYjB,GAAZ,EAAiBY,UAAjB,EAA6BX,MAA7B,CAAP;AACH,KAFD;AAGH,CAJD,MAKK;AACDX,YAAQqB,aAAR,GAAwB,UAAUX,GAAV,EAAeY,UAAf,EAA2BX,MAA3B,EAAmC;AACvD,eAAO,IAAIJ,MAAJ,CAAWG,GAAX,EAAgBY,UAAhB,EAA4BX,MAA5B,CAAP;AACH,KAFD;AAGH","file":"helpers.js","sourcesContent":["'use strict';\nconst Dim4 = require('./Dim4');\nconst _ = require('lodash');\nconst assert = require('assert');\nconst fastcall = require('fastcall');\nconst ArrayType = fastcall.ArrayType;\nconst FloatArray = new ArrayType('float');\nconst semver = require('semver');\n\nconst helpers = exports;\n\nhelpers.getHandle = function (array) {\n    if (array.handle) {\n        return array.handle;\n    }\n    return array;\n};\n\nhelpers.toBuffer = function (obj) {\n    if (Buffer.isBuffer(obj)) {\n        return obj;\n    }\n    if (_.isArray(obj)) {\n        const arr = new FloatArray(obj.length);\n        for (let i = 0; i < obj.length; i++) {\n            arr.set(i, Number(obj[i]));\n        }\n        return arr.buffer;\n    }\n    if (_.isTypedArray(obj)) {\n        return _typedArrayToBuffer(obj);\n    }\n    throw new TypeError('Argument \"obj\" is not a Buffer.');\n};\n\nhelpers.typedArrayToBuffer = function (arr) {\n    assert(_.isTypedArray(arr), 'Argument \"arr\" is not a typed array.');\n\n    return _typedArrayToBuffer(arr);\n};\n\nfunction _typedArrayToBuffer(arr) {\n    if (arr.byteLength !== arr.buffer.byteLength) {\n        return helpers.arrayToBuffer(arr.buffer, arr.byteOffset, arr.byteLength);\n    }\n    return helpers.arrayToBuffer(arr.buffer);\n}\n\nif (semver.gt(process.versions.node, '5.1.0')) {\n    helpers.arrayToBuffer = function (arr, byteOffset, length) {\n        return Buffer.from(arr, byteOffset, length);\n    };\n}\nelse {\n    helpers.arrayToBuffer = function (arr, byteOffset, length) {\n        return new Buffer(arr, byteOffset, length);\n    };\n}"]}